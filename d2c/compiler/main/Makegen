open(FILELOC,">$srcdir/file-locations.dylan")
    || die "cannot create file-locations.dylan";
## double any backslashes that might for some reason appear in the destdir.
$munged_destdir = $default_DYLANDIR || $destdir;
$munged_destdir =~ s/\\/\\\\/g;
$munged_destuserdir = $sitelibdirprefix;
$munged_destuserdir =~ s/\\/\\\\/g;
$GC_CFLAGS =~ s/\\/\\\\/g;
$GC_LIBS =~ s/\\/\\\\/g;
print FILELOC <<"EOF";
Module: main-constants
Note: this file is generated by gen-makefile from Makegen

define constant \$default-dylan-dir = "$munged_destdir";
define constant \$default-dylan-user-dir = "$munged_destuserdir";

define constant \$gc-libs = "$GC_LIBS";

define constant \$default-target-name = "$target_name";
EOF
close(FILELOC);

open(VERSION,">$srcdir/version.dylan")
    || die "cannot create version.dylan";
print VERSION <<"EOF";
Module: main-constants
Note: this file is generated by gen-makefile from Makegen

define constant \$version = "$version";
define constant \$bootstrap-counter = $bootstrap_counter;
EOF
close(VERSION);

$CPPFLAGS = "$CPPFLAGS -I../../runtime ";
$D2CFLAGS         # added by update-libdirs
    = $d2c_runtime
    . ' -L../../../common/collection-extensions'
    . ' -L../../../common/command-line-parser'
    . ' -L../../../common/command-processor'
    . ' -L../../../common/common-dylan'
    . ' -L../../../common/io'
    . ' -L../../../common/stream-extensions'
    . ' -L../../../common/string-extensions'
    . ' -L../../../common/system'
    . ' -L../../../common/table-extensions'
    . ' -L../base'
    . ' -L../cback'
    . ' -L../convert'
    . ' -L../fer-transform'
    . ' -L../front'
    . ' -L.'
    . ' -L../optimize'
    . ' -L../parser'
    . ' -L../../debugger'
    . ' -L../../runtime/random'
    . ' -L../../runtime/threads';

do emit_library_rule('Main-DU', '$(BUILDROOT)/force.timestamp', '', 
		     'compile', 'install');
do emit_library_rule('Main', '$(BUILDROOT)/force.timestamp', '', 
		     'compile', 'install');

